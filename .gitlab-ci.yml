image: docker:latest

services:
  - docker:dind

stages:
  - build
  - deploy

maven-build:
  image: maven:3-jdk-8
  stage: build
  script: "mvn package -B"
  artifacts:
    paths:
      - target/deployment/*.jar
    expire_in: 1 week

aws-deploy:
  image: python
  stage: deploy
  script:
    - "pip3 install awscli --upgrade"
    - "aws --version"
    - "export AWS_ACCESS_KEY_ID=AKIAI726JYFRYNPTQOKA"
    - "export AWS_SECRET_ACCESS_KEY=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"
    - "export AWS_DEFAULT_REGION=ap-south-1"
    - "ls -ltr"
    - "aws lambda update-function-code --function-name DemoAppLambdaFunction --zip-file fileb://."